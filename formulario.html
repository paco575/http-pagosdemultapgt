<!doctype html>
<html lang="es">
<head>

  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Formulario de datos</title>
  <style>
    :root{
      --bg:#f7f9fc; --card:#fff; --accent:#2b7cff; --muted:#6b7280;
    }
    body{
      font-family:system-ui,-apple-system,Segoe UI,Roboto,"Helvetica Neue",Arial;
      background:var(--bg); color:#111; margin:0; padding:32px;
      display:flex; align-items:flex-start; justify-content:center; min-height:100vh;
    }

     body::before {
      content: "";
      position: fixed;
      top: 6; left: 5;
      width: 80%; height: 80%;
      background: url("IMG_7538.JPG") no-repeat center center/cover;
      filter: blur(10px);
      transform: scale(1.1);
      z-index: -1;
    }
    
    .container{
      width:100%; max-width:820px; background:var(--card); border-radius:12px;
      box-shadow:0 6px 24px rgba(18,38,63,.08); padding:24px;
    }
    h1{margin:0 0 12px 0; font-size:20px;}
    form{display:grid; grid-template-columns:1fr 1fr; gap:12px;}
    label{display:block; font-size:13px; color:var(--muted); margin-bottom:6px;}
    input[type="text"], input[type="date"], textarea, select{
      width:100%; padding:10px 12px; border:1px solid #e6e9ef; border-radius:8px;
      font-size:14px; box-sizing:border-box;
    }
    .full { grid-column:1 / -1; }
    .buttons { display:flex; gap:8px; justify-content:flex-end; align-items:center; margin-top:8px; }
    button{padding:10px 14px; border-radius:8px; border:0; cursor:pointer; font-weight:600;}
    .btn-primary{background:var(--accent); color:white;}
    .btn-ghost{background:transparent; border:1px solid #e6e9ef; color:#111;}
    .error{color:#b91c1c; font-size:13px; margin-top:6px;}
    .preview{margin-top:16px; padding:12px; border-radius:8px; background:#fbfdff; border:1px solid #eef5ff; font-size:14px;}
    .small{font-size:12px; color:var(--muted);}
  </style>
</head>
<body>
  <div class="container" role="main">
    <img src="IMG_7538.JPG" alt="Logo PGT" class="logo-principal" width="100" , height="100" >
  ¡

    
    <h1>Formulario de registro</h1>
    <p class="small">Rellena los datos. Una vez rellenado los datos sera enviado a la pagina para realizar el pago.</p>

    <form id="dataForm" novalidate>
      <div>
        <label for="nombre">Nombre</label>
        <input id="nombre" name="nombre" type="text" required placeholder="Ej. María" />
        <div class="error" id="err-nombre" aria-live="polite"></div>
      </div>

      <div>
        <label for="apellidos">Apellidos</label>
        <input id="apellidos" name="apellidos" type="text" required placeholder="Ej. García Pérez" />
        <div class="error" id="err-apellidos" aria-live="polite"></div>
      </div>

      <div class="full">
        <label for="direccion">Dirección</label>
        <textarea id="direccion" name="direccion" rows="2" required placeholder="Calle, número, piso, ciudad..." ></textarea>
        <div class="error" id="err-direccion" aria-live="polite"></div>
      </div>

      <div>
        <label for="dni">DNI / NIE</label>
        <!-- acepta DNI (8 cifras + letra) o NIE (X/Y/Z + 7cifras + letra) -->
        <input id="dni" name="dni" type="text" required placeholder="12345678A o X1234567B"
               pattern="^([XYZxyz]\d{7}|\d{8})[A-Za-z]$" inputmode="text" />
        <div class="error" id="err-dni" aria-live="polite"></div>
      </div>

      <div>
        <label for="caducidad">Fecha de caducidad del carnet</label>
        <input id="caducidad" name="caducidad" type="date" required />
        <div class="error" id="err-caducidad" aria-live="polite"></div>
      </div>

      <div>
        <label for="modelo">Modelo del coche</label>
        <input id="modelo" name="modelo" type="text" required placeholder="Ej. Peugeot 308, Tesla Model 3" />
        <div class="error" id="err-modelo" aria-live="polite"></div>
      </div>

      <div>
        <label for="matricula">Matrícula</label>
        <!-- formato general: 4 dígitos + 3 letras (espacio opcional) -->
        <input id="matricula" name="matricula" type="text" required placeholder="1234 ABC"
               pattern="^\d{4}\s?[A-Za-z]{3}$" inputmode="text" />
        <div class="error" id="err-matricula" aria-live="polite"></div>
      </div>

      <div class="full buttons">
        <button type="button" class="btn-ghost" id="resetBtn">Limpiar</button>
        <button type="submit" class="btn-primary">Enviar</button>
      </div>
    </form>

    <div id="preview" class="preview" hidden aria-live="polite"></div>
  </div>

  <script>
    const form = document.getElementById('dataForm');
    const preview = document.getElementById('preview');

    // Helper para mostrar errores bajo cada campo
    function showError(id, msg) {
      document.getElementById('err-' + id).textContent = msg || '';
    }

    function clearErrors() {
      ['nombre','apellidos','direccion','dni','caducidad','modelo','matricula'].forEach(id => showError(id, ''));
    }

    // Validación adicional: fecha no en pasado
    function fechaNoPasada(value) {
      if (!value) return false;
      const d = new Date(value + 'T00:00:00');
      const hoy = new Date();
      // Comparar solo fecha (sin tiempo)
      hoy.setHours(0,0,0,0);
      return d >= hoy;
    }

    form.addEventListener('submit', (e) => {
      e.preventDefault();
      clearErrors();
      let ok = true;

      // Validaciones HTML5 básicas
      const requiredFields = ['nombre','apellidos','direccion','dni','caducidad','modelo','matricula'];
      requiredFields.forEach(id => {
        const el = document.getElementById(id);
        if (!el.value.trim()) {
          showError(id, 'Este campo es obligatorio.');
          ok = false;
        } else if (el.pattern) {
          const re = new RegExp(el.pattern);
          if (!re.test(el.value.trim())) {
            if (id === 'dni') showError(id, 'Formato DNI/NIE inválido (ej. 12345678A o X1234567B).');
            else if (id === 'matricula') showError(id, 'Formato matrícula inválido (ej. 1234 ABC).');
            else showError(id, 'Formato inválido.');
            ok = false;
          }
        }
      });

      // Fecha de caducidad
      const cad = document.getElementById('caducidad').value;
      if (cad && !fechaNoPasada(cad)) {
        showError('caducidad', 'La fecha no puede ser anterior a hoy.');
        ok = false;
      }

      if (!ok) {
        preview.hidden = true;
        return;
      }

      // Si todo OK, mostrar vista previa y ofrecer descarga JSON
      const data = {
        nombre: document.getElementById('nombre').value.trim(),
        apellidos: document.getElementById('apellidos').value.trim(),
        direccion: document.getElementById('direccion').value.trim(),
        dni: document.getElementById('dni').value.trim(),
        caducidad_carnet: document.getElementById('caducidad').value,
        modelo_coche: document.getElementById('modelo').value.trim(),
        matricula: document.getElementById('matricula').value.trim()
      };

      preview.hidden = false;
      preview.innerHTML = `
        <strong>Datos enviados:</strong>
        <div style="margin-top:8px; line-height:1.5;">
          <div><strong>Nombre:</strong> ${escapeHtml(data.nombre)}</div>
          <div><strong>Apellidos:</strong> ${escapeHtml(data.apellidos)}</div>
          <div><strong>Dirección:</strong> ${escapeHtml(data.direccion)}</div>
          <div><strong>DNI/NIE:</strong> ${escapeHtml(data.dni)}</div>
          <div><strong>Caducidad carnet:</strong> ${escapeHtml(data.caducidad_carnet)}</div>
          <div><strong>Modelo coche:</strong> ${escapeHtml(data.modelo_coche)}</div>
          <div><strong>Matrícula:</strong> ${escapeHtml(data.matricula)}</div>
        </div>
        <div style="margin-top:10px; display:flex; gap:8px;">
          <button id="Continuar con el pago" style="padding:8px 10px; border-radius:8px; border:0; background:#10b981; color:#fff; font-weight:600; cursor:pointer;">Descargar JSON</button>
        </div>
      `;

      document.getElementById('downloadJson').addEventListener('click', () => {
        const blob = new Blob([JSON.stringify(data, null, 2)], {type:'application/json'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'datos-formulario.json';
        document.body.appendChild(a);
        a.click();
        a.remove();
        URL.revokeObjectURL(url);
      });

      document.getElementById('copyBtn').addEventListener('click', async () => {
        try {
          await navigator.clipboard.writeText(JSON.stringify(data, null, 2));
          alert('Datos copiados al portapapeles');
        } catch (err) {
          alert('No se pudo copiar. Usa "Descargar JSON" en su lugar.');
        }
      });
    });

    document.getElementById('resetBtn').addEventListener('click', () => {
      form.reset();
      clearErrors();
      preview.hidden = true;
    });

    // Evitar HTML injection en la vista previa
    function escapeHtml(str) {
      return String(str)
        .replaceAll('&', '&amp;')
        .replaceAll('<', '&lt;')
        .replaceAll('>', '&gt;')
        .replaceAll('"', '&quot;')
        .replaceAll("'", '&#39;');
    }
  </script>
</body>
</html>
